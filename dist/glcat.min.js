// (c) 2018-2021 FMS_Cat - https://github.com/FMS-Cat/glcat-ts/blob/master/LICENSE
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GLCAT={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function e(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function n(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t}var i=34962,o=33071,a=36064,u=36096,f=34963,l=5126,s=36160,_=9729,h=36161,c=6408,d=34836,g=32856,p=3553,b=34067,m={get UnexpectedNullError(){var t=new Error("GLCat: Unexpected null detected");return t.name="UnexpectedNullError",t},get WebGL2ExclusiveError(){var t=new Error("GLCat: Attempted to use WebGL2 exclusive stuff");return t.name="WebGL2ExclusiveError",t}},v=function(){function t(t,e){this.__shaders=null,this.__attribLocationCache={},this.__uniformLocationCache={},this.__uniformTextureUnitMap={},this.__uniformtextureUnitIndex=0,this.__linked=!1,this.__glCat=t,this.__program=e}return Object.defineProperty(t.prototype,"program",{get:function(){return this.__program},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__program},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shaders",{get:function(){return this.__shaders?this.__shaders.concat():null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLinked",{get:function(){return this.__linked},enumerable:!1,configurable:!0}),t.prototype.dispose=function(t){if(void 0===t&&(t=!1),this.__glCat.gl.deleteProgram(this.__program),t){var e=this.shaders;e&&e.forEach((function(t){t.dispose()}))}},t.prototype.link=function(t,e){var r,n=this;void 0===e&&(e={});var i=this.__glCat.gl;if(t.forEach((function(t){return i.attachShader(n.__program,t.raw)})),e.transformFeedbackVaryings){if(!("function"==typeof WebGL2RenderingContext&&i instanceof WebGL2RenderingContext))throw m.WebGL2ExclusiveError;i.transformFeedbackVaryings(this.__program,e.transformFeedbackVaryings,null!==(r=e.transformFeedbackBufferMode)&&void 0!==r?r:i.SEPARATE_ATTRIBS)}if(i.linkProgram(this.__program),this.__linked=i.getProgramParameter(this.__program,35714),!this.__linked)throw new Error(i.getProgramInfoLog(this.__program));this.__shaders=t.concat()},t.prototype.linkAsync=function(t,e){var r,n=this;void 0===e&&(e={});var i=this.__glCat,o=this.__glCat.gl,a=i.getExtension("KHR_parallel_shader_compile");if(t.forEach((function(t){return o.attachShader(n.__program,t.raw)})),e.transformFeedbackVaryings){if(!("function"==typeof WebGL2RenderingContext&&o instanceof WebGL2RenderingContext))throw m.WebGL2ExclusiveError;o.transformFeedbackVaryings(this.__program,e.transformFeedbackVaryings,null!==(r=e.transformFeedbackBufferMode)&&void 0!==r?r:o.SEPARATE_ATTRIBS)}return o.linkProgram(this.__program),new Promise((function(e,r){var i=function(){var u;if(!a||!0===o.getProgramParameter(n.__program,37297))return n.__linked=o.getProgramParameter(n.__program,35714),n.__linked?(n.__shaders=t.concat(),void e()):void r(new Error(null!==(u=o.getProgramInfoLog(n.__program))&&void 0!==u?u:"null"));requestAnimationFrame(i)};i()}))},t.prototype.attribute=function(t,e,r,n,i,o,a){var u=this;void 0===r&&(r=1),void 0===n&&(n=0),void 0===i&&(i=l),void 0===o&&(o=0),void 0===a&&(a=0);var f=this.__glCat.gl,s=this.getAttribLocation(t);-1!==s&&(null!==e?this.__glCat.bindVertexBuffer(e,(function(){if(f.enableVertexAttribArray(s),f.vertexAttribPointer(s,r,i,!1,o,a),"function"==typeof WebGL2RenderingContext&&f instanceof WebGL2RenderingContext)f.vertexAttribDivisor(s,n);else{var t=u.__glCat.getExtension("ANGLE_instanced_arrays");t&&t.vertexAttribDivisorANGLE(s,n)}})):f.disableVertexAttribArray(s))},t.prototype.uniform=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=this["uniform"+e];o.call.apply(o,n([this,t],r))},t.prototype.uniformVector=function(t,e,r){this["uniform"+e].call(this,t,r)},t.prototype.uniform1i=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform1i(n,e)}))},t.prototype.uniform2i=function(t,e,r){var n=this.__glCat.gl,i=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){n.uniform2i(i,e,r)}))},t.prototype.uniform3i=function(t,e,r,n){var i=this.__glCat.gl,o=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){i.uniform3i(o,e,r,n)}))},t.prototype.uniform4i=function(t,e,r,n,i){var o=this.__glCat.gl,a=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){o.uniform4i(a,e,r,n,i)}))},t.prototype.uniform1iv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform1iv(n,e)}))},t.prototype.uniform2iv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform2iv(n,e)}))},t.prototype.uniform3iv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform3iv(n,e)}))},t.prototype.uniform4iv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform4iv(n,e)}))},t.prototype.uniform1f=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform1f(n,e)}))},t.prototype.uniform2f=function(t,e,r){var n=this.__glCat.gl,i=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){n.uniform2f(i,e,r)}))},t.prototype.uniform3f=function(t,e,r,n){var i=this.__glCat.gl,o=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){i.uniform3f(o,e,r,n)}))},t.prototype.uniform4f=function(t,e,r,n,i){var o=this.__glCat.gl,a=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){o.uniform4f(a,e,r,n,i)}))},t.prototype.uniform1fv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform1fv(n,e)}))},t.prototype.uniform2fv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform2fv(n,e)}))},t.prototype.uniform3fv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform3fv(n,e)}))},t.prototype.uniform4fv=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){r.uniform4fv(n,e)}))},t.prototype.uniformMatrix2fv=function(t,e,r){void 0===r&&(r=!1);var n=this.__glCat.gl,i=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){n.uniformMatrix2fv(i,r,e)}))},t.prototype.uniformMatrix3fv=function(t,e,r){void 0===r&&(r=!1);var n=this.__glCat.gl,i=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){n.uniformMatrix3fv(i,r,e)}))},t.prototype.uniformMatrix4fv=function(t,e,r){void 0===r&&(r=!1);var n=this.__glCat.gl,i=this.getUniformLocation(t);this.__glCat.useProgram(this,(function(){n.uniformMatrix4fv(i,r,e)}))},t.prototype.uniformTexture=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t),i=this.getUniformTextureUnit(t);r.activeTexture(33984+i),this.__glCat.bindTexture2D(null!=e?e:null),this.__glCat.useProgram(this,(function(){r.uniform1i(n,i)}))},t.prototype.uniformCubemap=function(t,e){var r=this.__glCat.gl,n=this.getUniformLocation(t),i=this.getUniformTextureUnit(t);r.activeTexture(33984+i),this.__glCat.bindTextureCubeMap(null!=e?e:null),this.__glCat.useProgram(this,(function(){r.uniform1i(n,i)}))},t.prototype.getAttribLocation=function(t){var e=this.__glCat.gl;if(void 0!==this.__attribLocationCache[t])return this.__attribLocationCache[t];var r=e.getAttribLocation(this.__program,t);return this.__attribLocationCache[t]=r,r},t.prototype.getUniformLocation=function(t){var e=this.__glCat.gl;if(void 0!==this.__uniformLocationCache[t])return this.__uniformLocationCache[t];var r=e.getUniformLocation(this.__program,t);return this.__uniformLocationCache[t]=r,r},t.prototype.getUniformTextureUnit=function(t){return void 0===this.__uniformTextureUnitMap[t]&&(this.__uniformTextureUnitMap[t]=this.__uniformtextureUnitIndex,this.__uniformtextureUnitIndex++),this.__uniformTextureUnitMap[t]},t}(),y=function(){function t(t,e){this.__prev=t,this.__binder=e}return t.prototype.bind=function(t,e){var r=this.__prev;if(t!==r&&(this.__binder(t),this.__prev=t),e){var n=e(t);return this.bind(r),n}},t}(),x=function(){function t(t,e){this.__glCat=t,this.__buffer=e}return Object.defineProperty(t.prototype,"buffer",{get:function(){return this.__buffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__buffer},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.__glCat.gl.deleteBuffer(this.__buffer)},t.prototype.setVertexbuffer=function(t,e){void 0===e&&(e=35044);var r=this.__glCat.gl;this.__glCat.bindVertexBuffer(this,(function(){r.bufferData(i,t,e)}))},t.prototype.setIndexbuffer=function(t,e){void 0===e&&(e=35044);var r=this.__glCat.gl;this.__glCat.bindIndexBuffer(this,(function(){r.bufferData(f,t,e)}))},t}(),C=function(){function t(t,e){this.__renderbufferMap=new Map,this.__textureMap=new Map,this.__glCat=t,this.__framebuffer=e}return Object.defineProperty(t.prototype,"framebuffer",{get:function(){return this.__framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderbuffer",{get:function(){var t;return null!==(t=this.__renderbufferMap.get(u))&&void 0!==t?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){var t;return null!==(t=this.__textureMap.get(a))&&void 0!==t?t:null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(t){var r,n,i,o;void 0===t&&(t=!1);var a=this.__glCat.gl;if(a.deleteFramebuffer(this.__framebuffer),t){try{for(var u=e(this.__renderbufferMap.values()),f=u.next();!f.done;f=u.next()){var l=f.value;a.deleteRenderbuffer(l.raw)}}catch(t){r={error:t}}finally{try{f&&!f.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}try{for(var s=e(this.__textureMap.values()),_=s.next();!_.done;_=s.next()){var h=_.value;a.deleteTexture(h.raw)}}catch(t){i={error:t}}finally{try{_&&!_.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}}},t.prototype.getRenderbuffer=function(t){var e;return void 0===t&&(t=u),null!==(e=this.__renderbufferMap.get(t))&&void 0!==e?e:null},t.prototype.getTexture=function(t){var e;return void 0===t&&(t=a),null!==(e=this.__textureMap.get(t))&&void 0!==e?e:null},t.prototype.attachRenderbuffer=function(t,e){var r=(void 0===e?{}:e).attachment,n=void 0===r?u:r,i=this.__glCat.gl;this.__glCat.bindFramebuffer(this,(function(){i.framebufferRenderbuffer(s,n,h,t.raw)})),this.__renderbufferMap.set(n,t)},t.prototype.attachTexture=function(t,e){var r=void 0===e?{}:e,n=r.level,i=void 0===n?0:n,o=r.attachment,u=void 0===o?a:o,f=this.__glCat.gl;this.__glCat.bindFramebuffer(this,(function(){f.framebufferTexture2D(s,u,p,t.raw,i)})),this.__textureMap.set(u,t)},t}(),w=function(){function t(t,e){this.__width=0,this.__height=0,this.__glCat=t,this.__renderbuffer=e}return Object.defineProperty(t.prototype,"renderbuffer",{get:function(){return this.__renderbuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__renderbuffer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.__width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.__height},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.__glCat.gl.deleteRenderbuffer(this.__renderbuffer)},t.prototype.renderbufferStorage=function(t,e,r){var n=(void 0===r?{}:r).format,i=void 0===n?this.__glCat.preferredDepthFormat:n,o=this.__glCat.gl;this.__glCat.bindRenderbuffer(this,(function(){o.renderbufferStorage(h,i,t,e)})),this.__width=t,this.__height=e},t.prototype.renderbufferStorageMultisample=function(t,e,r){var n=void 0===r?{}:r,i=n.samples,o=void 0===i?this.__glCat.preferredMultisampleSamples:i,a=n.format,u=void 0===a?this.__glCat.preferredDepthFormat:a,f=n.fallbackWebGL1,l=void 0===f||f,s=this.__glCat.gl;this.__glCat.bindRenderbuffer(this,(function(){if("function"==typeof WebGL2RenderingContext&&s instanceof WebGL2RenderingContext)s.renderbufferStorageMultisample(h,o,u,t,e);else{if(!l)throw m.WebGL2ExclusiveError;s.renderbufferStorage(h,u,t,e)}})),this.__width=t,this.__height=e},t}(),L=function(){function t(t,e){this.__compiled=!1,this.__glCat=t,this.__shader=e}return Object.defineProperty(t.prototype,"shader",{get:function(){return this.__shader},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__shader},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.__glCat.gl.deleteShader(this.__shader)},t.prototype.isCompiled=function(){return this.__compiled},t.prototype.compile=function(t){var e=this.__glCat.gl;if(e.shaderSource(this.__shader,t),e.compileShader(this.__shader),this.__compiled=e.getShaderParameter(this.__shader,35713),!this.__compiled)throw new Error(e.getShaderInfoLog(this.__shader))},t}(),E=new Uint8Array([0,0,0,0]),P=function(){function t(t,e){this.__width=0,this.__height=0,this.__glCat=t,this.__texture=e,this.textureFilter(_),this.textureWrap(o)}return Object.defineProperty(t.prototype,"texture",{get:function(){return this.__texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__texture},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.__width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.__height},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.__glCat.gl.deleteTexture(this.__texture)},t.prototype.textureFilter=function(t,e){void 0===t&&(t=9728),void 0===e&&(e=t);var r=this.__glCat.gl;this.__glCat.bindTexture2D(this,(function(){r.texParameteri(p,10240,t),r.texParameteri(p,10241,e)}))},t.prototype.textureWrap=function(t,e){void 0===t&&(t=o),void 0===e&&(e=t);var r=this.__glCat.gl;this.__glCat.bindTexture2D(this,(function(){r.texParameteri(p,10242,t),r.texParameteri(p,10243,e)}))},t.prototype.texStorage2D=function(t,e,r){var n=void 0===r?{}:r,i=n.target,o=void 0===i?p:i,a=n.level,u=void 0===a?1:a,f=n.format,l=void 0===f?g:f,s=this.__glCat.gl;if(!("function"==typeof WebGL2RenderingContext&&s instanceof WebGL2RenderingContext))throw m.WebGL2ExclusiveError;this.__glCat.bindTexture2D(this,(function(){s.texStorage2D(o,u,l,t,e)}))},t.prototype.getParameter=function(t){var e=this.__glCat.gl;return this.__glCat.bindTexture2D(this,(function(){return e.getParameter(t)}))},t.prototype.pixelStorei=function(t,e){var r=this.__glCat.gl;this.__glCat.bindTexture2D(this,(function(){r.pixelStorei(t,e)}))},t.prototype.setTexture=function(t){var e=this.__glCat.gl;this.__glCat.bindTexture2D(this,(function(){e.texImage2D(p,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)})),this.__width=t.width,this.__height=t.height},t.prototype.setTextureFromArray=function(t,e,r,n){var i=void 0===n?{}:n,o=i.internalformat,a=void 0===o?g:o,u=i.format,f=void 0===u?c:u,s=i.type,_=void 0===s?5121:s,h=this.__glCat.gl,b=a;"function"==typeof WebGL2RenderingContext&&h instanceof WebGL2RenderingContext?33325!==a&&33326!==a&&34842!==a&&a!==d||(this.__glCat.getExtension("EXT_color_buffer_float",!0),this.__glCat.getExtension("EXT_float_blend"),this.__glCat.getExtension("OES_texture_float_linear")):(5131===_?(this.__glCat.getExtension("OES_texture_half_float",!0),this.__glCat.getExtension("OES_texture_half_float_linear")):_===l&&(this.__glCat.getExtension("OES_texture_float",!0),this.__glCat.getExtension("OES_texture_float_linear")),b=f),this.__glCat.bindTexture2D(this,(function(){h.texImage2D(p,0,b,t,e,0,f,_,r)})),this.__width=t,this.__height=e},t.prototype.copyTexture=function(t,e){var r=this.__glCat.gl;this.__glCat.bindTexture2D(this,(function(){r.copyTexImage2D(p,0,c,0,0,t,e,0)})),this.__width=t,this.__height=e},t.prototype.setCubemap=function(t){var e=this.__glCat.gl;this.__glCat.bindTextureCubeMap(this,(function(){for(var r=0;r<6;r++)e.texImage2D(34069+r,0,c,c,5121,t[r]);e.texParameteri(b,10241,_),e.texParameteri(b,10240,_),e.texParameteri(b,10242,o),e.texParameteri(b,10243,o)}))},t.prototype.setZeroTexture=function(){this.setTextureFromArray(1,1,E)},t}(),T=function(){function t(t,e){this.__glCat=t,this.__transformFeedback=e}return Object.defineProperty(t.prototype,"transformFeedback",{get:function(){return this.__transformFeedback},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__transformFeedback},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){var t=this.__glCat.gl;"function"==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext&&t.deleteTransformFeedback(this.__transformFeedback)},t.prototype.bindBuffer=function(t,e){var r=this.__glCat.gl;"function"==typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext&&this.__glCat.bindTransformFeedback(this,(function(){var n;r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,t,null!==(n=null==e?void 0:e.buffer)&&void 0!==n?n:null)}))},t}(),G=function(){function t(t,e){this.__glCat=t,this.__vertexArray=e}return Object.defineProperty(t.prototype,"buffer",{get:function(){return this.__vertexArray},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"raw",{get:function(){return this.__vertexArray},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){var t=this.__glCat.gl;"function"==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?t.deleteVertexArray(this.__vertexArray):this.__glCat.getExtension("OES_vertex_array_object",!0).deleteVertexArrayOES(this.__vertexArray)},t.prototype.bindVertexbuffer=function(t,e,r,n,o,a,u){var f=this;void 0===r&&(r=1),void 0===n&&(n=0),void 0===o&&(o=l),void 0===a&&(a=0),void 0===u&&(u=0);var s=this.__glCat.gl;this.__glCat.bindVertexArray(this,(function(){if(s.bindBuffer(i,t.raw),s.enableVertexAttribArray(e),s.vertexAttribPointer(e,r,o,!1,a,u),"function"==typeof WebGL2RenderingContext&&s instanceof WebGL2RenderingContext)s.vertexAttribDivisor(e,n);else{var l=f.__glCat.getExtension("ANGLE_instanced_arrays");l&&l.vertexAttribDivisorANGLE(e,n)}}))},t.prototype.bindIndexbuffer=function(t){var e=this.__glCat.gl;this.__glCat.bindVertexArray(this,(function(){e.bindBuffer(f,t.raw)}))},t}(),F=function(){function t(t){var e=this;this.preferredMultisampleSamples=4,this.__bindHelperVertexBuffer=new y(null,(function(t){var r;e.__gl.bindBuffer(i,null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperIndexBuffer=new y(null,(function(t){var r;e.__gl.bindBuffer(f,null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperTransformFeedback=new y(null,(function(t){var r,n=e.__gl;if(!("function"==typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext))throw m.WebGL2ExclusiveError;n.bindTransformFeedback(36386,null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperVertexArray=new y(null,(function(t){var r;e.rawBindVertexArray(null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperTexture2D=new y(null,(function(t){var r;e.__gl.bindTexture(p,null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperTextureCubeMap=new y(null,(function(t){var r;e.__gl.bindTexture(b,null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperRenderbuffer=new y(null,(function(t){var r;e.__gl.bindRenderbuffer(h,null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperFramebuffer=new y(null,(function(t){var r;e.__gl.bindFramebuffer(s,null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperProgram=new y(null,(function(t){var r;e.__gl.useProgram(null!==(r=null==t?void 0:t.raw)&&void 0!==r?r:null)})),this.__bindHelperDrawBuffers=new y([a],(function(t){e.rawDrawBuffers(t)})),this.__extensionCache={},this.__gl=t,t.enable(2929),t.depthFunc(515),t.enable(3042),t.blendFunc(770,771),"function"==typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?this.preferredDepthFormat=33190:this.preferredDepthFormat=33189}return t.throwIfNull=function(t){if(null==t)throw m.UnexpectedNullError;return t},Object.defineProperty(t.prototype,"renderingContext",{get:function(){return this.__gl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gl",{get:function(){return this.__gl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dummyTexture",{get:function(){if(this.__dummyTextureCache)return this.__dummyTextureCache;var t=this.createTexture();return t.setTextureFromArray(1,1,new Uint8Array([255,0,255,255])),this.__dummyTextureCache=t,t},enumerable:!1,configurable:!0}),t.prototype.getExtension=function(t,e){var r=this.__gl;if(this.__extensionCache[t])return this.__extensionCache[t];if(this.__extensionCache[t]=r.getExtension(t),this.__extensionCache[t])return this.__extensionCache[t];if(e)throw new Error('GLCat.getExtension: The extension "'+t+'" is not supported');return null},t.prototype.getExtensions=function(t,e){var r=this;return t.map((function(t){return r.getExtension(t,e)}))},t.prototype.createShader=function(e){var r=this.__gl,n=t.throwIfNull(r.createShader(e));return new L(this,n)},t.prototype.createProgram=function(){var e=this.__gl,r=t.throwIfNull(e.createProgram());return new v(this,r)},t.prototype.lazyProgram=function(t,e,r){var n;void 0===r&&(r={});try{(n=this.createShader(35633)).compile(t);var i=this.createShader(35632);i.compile(e);var o=this.createProgram();return o.link([n,i],r),o}catch(t){throw null==n||n.dispose(),t}},t.prototype.lazyProgramAsync=function(t,e,r){void 0===r&&(r={});try{var n=this.createShader(35633);n.compile(t);var i=this.createShader(35632);i.compile(e);var o=this.createProgram();return o.linkAsync([n,i],r).then((function(){return o})).catch((function(t){return null==o||o.dispose(),null==i||i.dispose(),null==n||n.dispose(),Promise.reject(t)}))}catch(t){return Promise.reject(t)}},t.prototype.useProgram=function(t,e){return this.__bindHelperProgram.bind(t,e)},t.prototype.createBuffer=function(){var e=this.__gl,r=t.throwIfNull(e.createBuffer());return new x(this,r)},t.prototype.bindVertexBuffer=function(t,e){return this.__bindHelperVertexBuffer.bind(t,e)},t.prototype.bindIndexBuffer=function(t,e){return this.__bindHelperIndexBuffer.bind(t,e)},t.prototype.createTransformFeedback=function(){var e=this.__gl;if("function"==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext){var r=t.throwIfNull(e.createTransformFeedback());return new T(this,r)}throw m.WebGL2ExclusiveError},t.prototype.bindTransformFeedback=function(t,e){return this.__bindHelperTransformFeedback.bind(t,e)},t.prototype.createVertexArray=function(){var e=this.__gl;if("function"==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext){var r=t.throwIfNull(e.createVertexArray());return new G(this,r)}var n=this.getExtension("OES_vertex_array_object",!0);r=t.throwIfNull(n.createVertexArrayOES());return new G(this,r)},t.prototype.rawBindVertexArray=function(t){var e=this.__gl;"function"==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?e.bindVertexArray(t):this.getExtension("OES_vertex_array_object",!0).bindVertexArrayOES(t)},t.prototype.bindVertexArray=function(t,e){return this.__bindHelperVertexArray.bind(t,e)},t.prototype.createTexture=function(){var e=this.__gl,r=t.throwIfNull(e.createTexture());return new P(this,r)},t.prototype.bindTexture2D=function(t,e){return this.__bindHelperTexture2D.bind(t,e)},t.prototype.bindTextureCubeMap=function(t,e){return this.__bindHelperTextureCubeMap.bind(t,e)},t.prototype.createRenderbuffer=function(){var e=this.__gl,r=t.throwIfNull(e.createRenderbuffer());return new w(this,r)},t.prototype.bindRenderbuffer=function(t,e){return this.__bindHelperRenderbuffer.bind(t,e)},t.prototype.createFramebuffer=function(){var e=this.__gl,r=t.throwIfNull(e.createFramebuffer());return new C(this,r)},t.prototype.bindFramebuffer=function(t,e){return this.__bindHelperFramebuffer.bind(t,e)},t.prototype.lazyFramebuffer=function(t,e,r){var n,i,o,a=void 0===r?{}:r,f=a.isFloat,s=void 0!==f&&f,_=a.depthFormat,h=void 0===_?this.preferredDepthFormat:_;try{return o=this.createFramebuffer(),(i=this.createRenderbuffer()).renderbufferStorage(t,e,{format:h}),o.attachRenderbuffer(i,{attachment:u}),n=this.createTexture(),s?n.setTextureFromArray(t,e,null,{internalformat:d,format:c,type:l}):n.setTextureFromArray(t,e,null),o.attachTexture(n),o}catch(t){throw null==o||o.dispose(),null==n||n.dispose(),null==i||i.dispose(),t}},t.prototype.lazyMultisampleFramebuffer=function(t,e,r){var n=void 0===r?{}:r,i=n.samples,o=void 0===i?4:i,f=n.isFloat,l=void 0!==f&&f,s=n.depthFormat,_=void 0===s?this.preferredDepthFormat:s,h=n.fallbackWebGL1,c=void 0===h||h,p=this.__gl;if(!("function"==typeof WebGL2RenderingContext&&p instanceof WebGL2RenderingContext)){if(c)return this.lazyFramebuffer(t,e,{isFloat:l});throw m.WebGL2ExclusiveError}var b=void 0,v=void 0;try{v=this.createFramebuffer(),(b=this.createRenderbuffer()).renderbufferStorageMultisample(t,e,{samples:o,format:_}),v.attachRenderbuffer(b,{attachment:u});var y=this.createRenderbuffer(),x=l?d:g;return y.renderbufferStorageMultisample(t,e,{samples:o,format:x}),v.attachRenderbuffer(y,{attachment:a}),v}catch(t){throw null==v||v.dispose(),null==b||b.dispose(),t}},t.prototype.lazyDrawbuffers=function(t,e,r,n){var i=void 0===n?{}:n,o=i.isFloat,f=void 0!==o&&o,s=i.depthFormat,_=void 0===s?this.preferredDepthFormat:s;if(34852<r)throw new Error("GLCat: Maximum draw buffers count exceeded");var h;try{h=this.createFramebuffer();var g=this.createRenderbuffer();g.renderbufferStorage(t,e,{format:_}),h.attachRenderbuffer(g,{attachment:u});for(var p=0;p<r;p++){var b=this.createTexture();f?b.setTextureFromArray(t,e,null,{internalformat:d,format:c,type:l}):b.setTextureFromArray(t,e,null),h.attachTexture(b,{attachment:a+p})}return h}catch(t){throw[].forEach((function(t){t.dispose()})),null==h||h.dispose(),t}},t.prototype.rawDrawBuffers=function(t){var e=this.__gl;if("function"==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)e.drawBuffers(t);else{var r=this.getExtension("WEBGL_draw_buffers");null==r||r.drawBuffersWEBGL(t)}},t.prototype.drawBuffers=function(t,e){var r;if(Array.isArray(t))r=t;else if(t){r=[];for(var n=0;n<t;n++)r[n]=a+n}else r=[a];return this.__bindHelperDrawBuffers.bind(r,e)},t.prototype.drawArraysInstanced=function(t,e,r,n){var i=this.gl;"function"==typeof WebGL2RenderingContext&&i instanceof WebGL2RenderingContext?i.drawArraysInstanced(t,e,r,n):this.getExtension("ANGLE_instanced_arrays",!0).drawArraysInstancedANGLE(t,e,r,n)},t.prototype.drawElementsInstanced=function(t,e,r,n,i){var o=this.gl;"function"==typeof WebGL2RenderingContext&&o instanceof WebGL2RenderingContext?o.drawElementsInstanced(t,e,r,n,i):this.getExtension("ANGLE_instanced_arrays",!0).drawElementsInstancedANGLE(t,e,r,n,i)},t.prototype.clear=function(t,e,r,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=1);var o=this.__gl;o.clearColor(t,e,r,n),o.clearDepth(i),o.clear(16640)},t.prototype.blitFramebuffer=function(t,e,r){var n,i,o,a,u,f,l,s,_,h,c=void 0===r?{}:r,d=c.srcViewport,g=void 0===d?[0,0,null!==(i=null===(n=null==t?void 0:t.renderbuffer)||void 0===n?void 0:n.width)&&void 0!==i?i:0,null!==(a=null===(o=null==t?void 0:t.renderbuffer)||void 0===o?void 0:o.height)&&void 0!==a?a:0]:d,p=c.dstViewport,b=void 0===p?[0,0,null!==(f=null===(u=null==e?void 0:e.renderbuffer)||void 0===u?void 0:u.width)&&void 0!==f?f:0,null!==(s=null===(l=null==e?void 0:e.renderbuffer)||void 0===l?void 0:l.height)&&void 0!==s?s:0]:p,v=c.mask,y=void 0===v?16384:v,x=c.filter,C=void 0===x?9728:x,w=this.__gl;if(!("function"==typeof WebGL2RenderingContext&&w instanceof WebGL2RenderingContext))throw m.WebGL2ExclusiveError;w.bindFramebuffer(36008,null!==(_=null==t?void 0:t.raw)&&void 0!==_?_:null),w.bindFramebuffer(36009,null!==(h=null==e?void 0:e.raw)&&void 0!==h?h:null),w.blitFramebuffer(g[0],g[1],g[2],g[3],b[0],b[1],b[2],b[3],y,C),w.bindFramebuffer(36008,null),w.bindFramebuffer(36009,null)},t}();t.GLCat=F,t.GLCatBuffer=x,t.GLCatFramebuffer=C,t.GLCatProgram=v,t.GLCatRenderbuffer=w,t.GLCatShader=L,t.GLCatTexture=P,t.GLCatTransformFeedback=T,t.GLCatVertexArray=G,t.default=F,Object.defineProperty(t,"__esModule",{value:!0})}));
